<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form/Newsletter Component</title>

    <!-- Design System Variables -->
    <link rel="stylesheet" href="../../styles/variables-v4.0-20251027.css">

    <!-- Form Newsletter Component Styles -->
    <link rel="stylesheet" href="../../styles/molecules-form-newsletter.css">

    <!-- Demo Styles -->
    <link rel="stylesheet" href="../../styles/molecules-form-newsletter-demo.css">
</head>
<body>
    <!-- Newsletter Form Component -->
    <div class="form-newsletter form-newsletter--desktop-plus" data-state="default">
        <!-- Title -->
        <h3 class="form-newsletter__title">Stay Connected</h3>
        
        <!-- Description -->
        <p class="form-newsletter__description">
            Share your email address and get our B2B marketing strategies and digital transformation in your inbox.
        </p>
        
        <!-- HubSpot Form Container (Primary Implementation) -->
        <div class="form-newsletter__hubspot-container" id="hubspot-newsletter-form">
            <!-- HubSpot form will be embedded here via JavaScript -->
        </div>
        
        <!-- Fallback HTML Form (shown immediately for now) -->
        <form class="form-newsletter__fallback" id="newsletter-fallback-form">
            <!-- Field Container -->
            <div class="form-newsletter__field-container">
                <!-- Label -->
                <label for="email" class="form-newsletter__label">Email Address*</label>
                
                <!-- Input Wrapper -->
                <div class="form-newsletter__input-wrapper">
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        class="form-newsletter__input" 
                        placeholder="Write your input here"
                        required
                        aria-required="true"
                        aria-invalid="false"
                    />
                </div>
                
                <!-- Helper Text -->
                <span class="form-newsletter__helper">*This field is required.</span>
            </div>
            
            <!-- Submit Container -->
            <div class="form-newsletter__submit-container">
                <button type="submit" class="form-newsletter__submit">
                    Subscribe Now
                </button>
            </div>
        </form>
        
        <!-- Success State (Hidden by default) -->
        <div class="form-newsletter__success form-newsletter__success--hidden" id="newsletter-success">
            <!-- Success Title -->
            <h3 class="form-newsletter__title">Success!</h3>
            
            <!-- Success Description -->
            <p class="form-newsletter__description">
                Check your email inbox for our confirmation email. Thank you!
            </p>
            
            <!-- Success CTA -->
            <div class="form-newsletter__submit-container">
                <p class="form-newsletter__success-message">
                    While you're here, why not check out this valuable resource that was published for busy executives like you?
                </p>
                <a href="#" class="form-newsletter__success-link">Download the Resource Here</a>
            </div>
        </div>
    </div>
    
    <!-- JavaScript for HubSpot Integration and Form Handling -->
    <script>
        // Configuration
        const HUBSPOT_CONFIG = {
            portalId: '48424315', // Purposeful Media HubSpot Portal ID
            formId: '2ed5d7e7-71f6-4b75-90e9-162875f65d4d', // Newsletter Form ID
            region: 'na1', // North America region
            target: '#hubspot-newsletter-form',
            cssRequired: false, // We're providing custom styles
            onFormSubmitted: function() {
                handleFormSuccess();
            },
            onFormReady: function() {
                console.log('HubSpot form loaded successfully');
                // Hide fallback form when HubSpot loads successfully
                const fallbackForm = document.getElementById('newsletter-fallback-form');
                if (fallbackForm) {
                    fallbackForm.classList.add('form-newsletter__fallback--hidden');
                }
            },
            onFormSubmitError: function(error) {
                console.error('HubSpot form submission error:', error);
                showFallbackForm();
            }
        };
        
        // Load HubSpot Forms Script
        function loadHubSpotForms() {
            // Load HubSpot forms library
            const script = document.createElement('script');
            script.src = '//js.hsforms.net/forms/v2.js';
            script.onload = function() {
                // Create HubSpot form
                window.hbspt.forms.create({
                    ...HUBSPOT_CONFIG
                });
            };
            script.onerror = function() {
                console.error('Failed to load HubSpot forms script');
                showFallbackForm();
            };
            document.head.appendChild(script);
        }
        
        // Show fallback form if HubSpot fails
        function showFallbackForm() {
            const hubspotContainer = document.getElementById('hubspot-newsletter-form');
            const fallbackForm = document.getElementById('newsletter-fallback-form');

            if (hubspotContainer) {
                hubspotContainer.classList.add('form-newsletter__hubspot-container--hidden');
            }
            if (fallbackForm) {
                fallbackForm.classList.remove('form-newsletter__fallback--hidden');
            }
        }
        
        // Handle successful form submission
        function handleFormSuccess() {
            const component = document.querySelector('.form-newsletter');
            const form = document.getElementById('newsletter-fallback-form');
            const hubspot = document.getElementById('hubspot-newsletter-form');
            const success = document.getElementById('newsletter-success');
            const title = component.querySelector('.form-newsletter__title');
            const description = component.querySelector('.form-newsletter__description');

            // Hide form elements by adding hidden class
            if (form) form.classList.add('form-newsletter__fallback--hidden');
            if (hubspot) hubspot.classList.add('form-newsletter__hubspot-container--hidden');
            if (title && title.textContent === 'Stay Connected') title.classList.add('form-newsletter__success--hidden');
            if (description && description.textContent.includes('Share your email')) description.classList.add('form-newsletter__success--hidden');

            // Show success message by removing hidden class
            if (success) {
                success.classList.remove('form-newsletter__success--hidden');
            }

            // Update component state
            if (component) {
                component.setAttribute('data-state', 'success');
                component.classList.add('form-newsletter--success');
            }
        }
        
        // Handle fallback form submission
        function handleFallbackSubmit(event) {
            event.preventDefault();
            
            const form = event.target;
            const emailInput = form.querySelector('#email');
            const email = emailInput.value;
            const component = document.querySelector('.form-newsletter');
            
            // Basic email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                // Show error state
                emailInput.classList.add('form-newsletter__input--error');
                emailInput.setAttribute('aria-invalid', 'true');
                component.classList.add('form-newsletter--error');
                
                // Update helper text
                const helper = form.querySelector('.form-newsletter__helper');
                if (helper) {
                    helper.textContent = 'Please check your address format and try again.';
                    helper.classList.add('form-newsletter__helper--error');
                }
                
                return;
            }
            
            // Here you would typically submit to your backend
            console.log('Fallback form submitted with email:', email);
            
            // Simulate success for demo
            handleFormSuccess();
        }
        
        // Handle input field interactions
        function setupFieldInteractions() {
            const emailInput = document.querySelector('.form-newsletter__input');
            const component = document.querySelector('.form-newsletter');
            
            if (emailInput && component) {
                // Hover state
                component.addEventListener('mouseenter', function() {
                    if (!component.classList.contains('form-newsletter--active')) {
                        component.classList.add('form-newsletter--hover');
                    }
                });
                
                component.addEventListener('mouseleave', function() {
                    component.classList.remove('form-newsletter--hover');
                });
                
                // Focus state
                emailInput.addEventListener('focus', function() {
                    component.setAttribute('data-state', 'active');
                    component.classList.remove('form-newsletter--hover');
                    component.classList.add('form-newsletter--active');
                });
                
                // Blur state
                emailInput.addEventListener('blur', function() {
                    component.setAttribute('data-state', 'default');
                    component.classList.remove('form-newsletter--active');
                });
                
                // Clear error on typing
                emailInput.addEventListener('input', function() {
                    if (this.classList.contains('form-newsletter__input--error')) {
                        this.classList.remove('form-newsletter__input--error');
                        this.setAttribute('aria-invalid', 'false');
                        component.classList.remove('form-newsletter--error');
                        
                        // Reset helper text
                        const helper = this.closest('form').querySelector('.form-newsletter__helper');
                        if (helper) {
                            helper.textContent = '*This field is required.';
                            helper.classList.remove('form-newsletter__helper--error');
                        }
                    }
                });
            }
        }
        
        // Responsive handling
        function updateBreakpoint() {
            const component = document.querySelector('.form-newsletter');
            
            if (!component) return;
            
            const width = window.innerWidth;
            
            // Remove all breakpoint classes
            component.classList.remove(
                'form-newsletter--desktop-plus',
                'form-newsletter--desktop', 
                'form-newsletter--tablet',
                'form-newsletter--mobile'
            );
            
            // Add appropriate breakpoint class
            if (width >= 1920) {
                component.classList.add('form-newsletter--desktop-plus');
            } else if (width >= 1150) {
                component.classList.add('form-newsletter--desktop');
            } else if (width >= 768) {
                component.classList.add('form-newsletter--tablet');
            } else {
                component.classList.add('form-newsletter--mobile');
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Try to load HubSpot forms (currently commented out)
            loadHubSpotForms();
            
            // Setup fallback form
            const fallbackForm = document.getElementById('newsletter-fallback-form');
            if (fallbackForm) {
                fallbackForm.addEventListener('submit', handleFallbackSubmit);
            }
            
            // Setup field interactions
            setupFieldInteractions();
            
            // Setup responsive handling
            updateBreakpoint();
            window.addEventListener('resize', updateBreakpoint);
            
            // Set a timeout to show fallback if HubSpot doesn't load
            setTimeout(function() {
                const hubspotForm = document.querySelector('.hs-form');
                if (!hubspotForm) {
                    console.log('HubSpot form not loaded after 5 seconds, showing fallback');
                    showFallbackForm();
                }
            }, 5000); // 5 second timeout
        });
    </script>
</body>
</html>
